<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BINGO MYSTERY AI - Strategic Mode</title>
    <style>
        :root { --bg: #0f172a; --glass: rgba(255, 255, 255, 0.1); }
        .col-red { --theme: #ff4d4d; } .col-blue { --theme: #4d94ff; } .col-green { --theme: #2ecc71; } .col-yellow { --theme: #f1c40f; }

        body { font-family: sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden; }
        
        .setup-section { width: 95%; max-width: 400px; background: var(--glass); padding: 10px; border-radius: 12px; margin-bottom: 10px; border: 1px dashed #4facfe; box-sizing: border-box; }
        .setup-section input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #334155; background: #000; color: #fff; box-sizing: border-box; }

        .item-inventory { width: 95%; max-width: 400px; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); padding: 10px 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid gold; box-sizing: border-box; }
        .item-btn { background: linear-gradient(135deg, gold, #f39c12); color: black; border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 0.8rem; }

        .bingo-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; width: 100%; max-width: 400px; margin-bottom: 20px; }
        .cell { aspect-ratio: 1/1; background: var(--glass); border: 2px solid var(--theme); border-radius: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 0.6rem; font-weight: bold; text-align: center; cursor: pointer; padding: 5px; box-sizing: border-box; color: var(--theme); transition: 0.3s; }
        .cell.identified { background: rgba(255, 255, 255, 0.05); box-shadow: inset 0 0 10px var(--theme); color: #fff; } 
        .cell.complete { background: var(--theme); color: #000; border: none; box-shadow: 0 0 15px var(--theme); }
        .ans-label { font-size: 0.5rem; margin-top: 4px; border-top: 1px solid rgba(0,0,0,0.2); width: 100%; padding-top: 2px; }

        #clear-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; flex-direction: column; justify-content: center; align-items: center; background: radial-gradient(circle, #1e293b, #000); text-align: center; padding: 20px; box-sizing: border-box; }
        .clear-card { background: rgba(255,255,255,0.05); padding: 30px 20px; border-radius: 30px; border: 2px solid gold; box-shadow: 0 0 50px rgba(212, 175, 55, 0.3); width: 90%; max-width: 400px; position: relative; z-index: 2100; }
        .gold-title { font-size: 2.5rem; font-weight: bold; background: linear-gradient(to bottom, #fff, #d4af37); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 10px gold); margin-bottom: 15px; }
        .confetti { position: absolute; width: 10px; height: 10px; background: gold; animation: fall 3s linear infinite; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        #view-container { width: 100%; aspect-ratio: 1/1; background: #000; border-radius: 15px; overflow: hidden; margin: 10px 0; border: 2px solid #334155; position: relative; }
        video, canvas { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }
        
        button { border: none; border-radius: 10px; padding: 14px; font-weight: bold; cursor: pointer; width: 100%; font-size: 1rem; margin-top: 10px; }
        .btn-target { background: #1e293b; color: white; border: 1px solid #4facfe; font-size: 0.8rem; padding: 10px; margin-bottom: 5px; border-radius: 8px; width: 100%; }
    </style>
</head>
<body>

    <h2 style="margin: 10px 0;">BINGO MYSTERY AI</h2>

    <div class="setup-section">
        <input type="password" id="test-api-key" placeholder="Gemini APIã‚­ãƒ¼ã‚’å…¥åŠ›">
    </div>

    <div class="item-inventory">
        <div>
            <span style="font-size: 0.6rem; color: gold; display: block;">ITEM: ãƒã‚¹ã‚¿ãƒ¼ã‚­ãƒ¼</span>
            <span id="item-count" style="font-size: 1.2rem; font-weight: bold;">0</span>
        </div>
        <button id="use-item-btn" class="item-btn" onclick="toggleItemMode()">ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½¿ã†</button>
    </div>

    <div class="bingo-grid" id="bingo-board"></div>

    <button style="background:none; color:#444; border:none; font-size:0.6rem; margin: 20px 0;" onclick="resetGame()">é€²æ—ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æœ€åˆã‹ã‚‰</button>

    <div id="clear-overlay">
        <div id="confetti-container"></div>
        <div class="clear-card">
            <div id="clear-title" class="gold-title">FINISH</div>
            <p id="clear-msg" style="line-height: 1.6; margin-bottom: 20px;"></p>
            <div id="hint-box" style="display:none; color: gold; font-size: 0.8rem; border-top: 1px solid #444; padding-top: 15px; margin-bottom: 15px;"></div>
            <button id="close-finale-btn" style="background:#fff; color:#000;" onclick="closeFinale()">æ¬¡ã¸</button>
        </div>
    </div>

    <div id="bingo-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1500; flex-direction:column; justify-content:center; align-items:center; pointer-events:none;">
        <div style="font-size:4rem; font-weight:bold; color:gold; animation:bounce 1s infinite;">BINGO!</div>
    </div>

    <div id="modal">
        <div class="modal-content" style="max-width: 400px; margin: auto;">
            <h2 id="modal-title" style="color:#4facfe; margin:0 0 10px 0;">TARGET</h2>
            <div id="capture-section">
                <div id="view-container"><video id="video" autoplay playsinline></video><canvas id="canvas"></canvas></div>
                <button style="background:#4facfe; color:white; width:100%; padding:15px; border-radius:10px;" onclick="analyzeSpot()">ğŸ“¸ æ’®å½±ã—ã¦ã€Œé–‹æ”¾ã€ã™ã‚‹</button>
            </div>
            <div id="riddle-section" style="display:none;" class="input-group">
                <p id="riddle-text" style="line-height: 1.6; margin-bottom: 10px;"></p>
                <input type="text" id="answer-input" style="width:100%; padding:12px; border-radius:8px; background:#1e293b; color:white; border:1px solid #475569; box-sizing:border-box;" placeholder="ç­”ãˆã‚’å…¥åŠ›">
                <button id="check-ans-btn" style="background:#fbbf24; color:black; width:100%;" onclick="verifyAnswer()">æ­£è§£åˆ¤å®šã™ã‚‹</button>
                <div id="target-selection-area" style="display:none; margin-top:20px; border-top:1px solid #444; padding-top:15px;">
                    <label style="display:block; font-size:0.8rem; color:#4facfe; margin-bottom:10px;">ç©ºã‘ã‚‹ãƒã‚¹ã‚’é¸ã‚“ã§ãã ã•ã„ï¼š</label>
                    <div id="target-list"></div>
                </div>
            </div>
            <button style="background:#334155; color:white; width:100%; margin-top:10px;" onclick="closeModal()">æˆ»ã‚‹</button>
        </div>
    </div>

    <script>
        const DEFAULT_DATA = [
            { id: 0, color: 'red', target: "ã‚»ãƒ–ãƒ³ã‚¤ãƒ¬ãƒ–ãƒ³", riddle: "ã€Œæœã¯4æœ¬ã€æ˜¼ã¯2æœ¬ã€å¤œã¯3æœ¬ã€ã•ã¦ä½•ï¼Ÿ", answer: "äººé–“", trueAnswer: "ã‚»ãƒ–ãƒ³", identified: false, solved: false, riddleCleared: false, clearsId: 5 },
            { id: 1, color: 'blue', target: "ä»»å¤©å ‚", riddle: "ãƒãƒªã‚ªã®å¸½å­ã®ãƒãƒ¼ã‚¯ã¯ï¼Ÿ", answer: "M", trueAnswer: "ä»»å¤©å ‚", identified: false, solved: false, riddleCleared: false, clearsId: 0 },
            { id: 2, color: 'green', target: "ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼", riddle: "ãƒŸãƒƒã‚­ãƒ¼ã®èª•ç”Ÿæ—¥ã¯11æœˆ18æ—¥ã€‚ã§ã¯ãƒŸãƒ‹ãƒ¼ã¯ï¼Ÿ", answer: "11æœˆ18æ—¥", trueAnswer: "ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼", identified: false, solved: false, riddleCleared: false, clearsId: 10 },
            { id: 3, color: 'yellow', target: "ãƒ•ã‚¡ãƒŸãƒ", riddle: "ã€Œã‚ãªãŸã¨ã‚³ãƒ³ãƒ“ã«ã€ã®ç¶šãã¯ï¼Ÿ", answer: "ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆ", trueAnswer: "ãƒ•ã‚¡ãƒŸãƒ", identified: false, solved: false, riddleCleared: false, clearsId: 15 },
            { id: 4, color: 'yellow', target: "ãƒ­ãƒ¼ã‚½ãƒ³", riddle: "ãƒŸãƒ«ã‚¯ç¼¶ã®è‰²ã¯ï¼Ÿ", answer: "ç™½", trueAnswer: "ãƒ­ãƒ¼ã‚½ãƒ³", identified: false, solved: false, riddleCleared: false, clearsId: 1 },
            { id: 5, color: 'green', target: "ãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰", riddle: "ãƒãƒ†ãƒˆMã®ç›®å®‰gæ•°ã¯ï¼Ÿ", answer: "135", trueAnswer: "ãƒãƒƒã‚¯", identified: false, solved: false, riddleCleared: false, clearsId: 12 },
            { id: 6, color: 'blue', target: "éƒµä¾¿å±€", riddle: "éƒµä¾¿ãƒãƒ¼ã‚¯ï¼ˆã€’ï¼‰ã®ç”±æ¥ã¯ï¼Ÿ", answer: "ãƒ†", trueAnswer: "ãƒ¦ã‚¦ãƒ“ãƒ³", identified: false, solved: false, riddleCleared: false, clearsId: 3 },
            { id: 7, color: 'red', target: "ã‚¹ã‚¿ãƒ", riddle: "äººé­šã®åå‰ã¯ï¼Ÿ", answer: "ã‚µã‚¤ãƒ¬ãƒ³", trueAnswer: "ã‚¹ã‚¿ãƒ", identified: false, solved: false, riddleCleared: false, clearsId: 6 },
            { id: 8, color: 'blue', target: "ãƒ€ã‚¤ã‚½ãƒ¼", riddle: "ç¤¾åã®ç”±æ¥ã¯ã€Œå¤§ããâ—â—ã‚‹ã€", answer: "å‰µã‚‹", trueAnswer: "ãƒ€ã‚¤ã‚½ãƒ¼", identified: false, solved: false, riddleCleared: false, clearsId: 2 },
            { id: 9, color: 'red', target: "ãƒ¦ãƒ‹ã‚¯ãƒ­", riddle: "æ­£å¼åç§°ã®æœ€å¾Œã¯ï¼Ÿ", answer: "ã‚¦ã‚§ã‚¢", trueAnswer: "ãƒ¦ãƒ‹ã‚¯ãƒ­", identified: false, solved: false, riddleCleared: false, clearsId: 13 },
            { id: 10, color: 'yellow', target: "ãã‚‰å¯¿å¸", riddle: "5çš¿ã§ã§ãã‚‹ã‚²ãƒ¼ãƒ åã¯ï¼Ÿ", answer: "ãƒ“ãƒƒãã‚‰ãƒãƒ³", trueAnswer: "ã‚¯ãƒ©ã‚¹ã‚·", identified: false, solved: false, riddleCleared: false, clearsId: 4 },
            { id: 11, color: 'green', target: "å‰é‡å®¶", riddle: "ç‰›ã®è§’ã®é–“ã«ã‚ã‚‹ã‚‚ã®ã¯ï¼Ÿ", answer: "ã²ã‚‡ã†ãŸã‚“", trueAnswer: "ãƒ¨ã‚·ãƒãƒ¤", identified: false, solved: false, riddleCleared: false, clearsId: 14 },
            { id: 12, color: 'green', target: "ãƒ‹ãƒˆãƒª", riddle: "ãŠã€ã­ã ã‚“â—â—â—", answer: "ä»¥ä¸Š", trueAnswer: "ãƒ‹ãƒˆãƒª", identified: false, solved: false, riddleCleared: false, clearsId: 7 },
            { id: 13, color: 'yellow', target: "ã‚¤ã‚ªãƒ³", riddle: "æ—§ç¤¾åã¯ï¼Ÿ", answer: "ã‚¸ãƒ£ã‚¹ã‚³", trueAnswer: "ã‚¤ã‚ªãƒ³", identified: false, solved: false, riddleCleared: false, clearsId: 8 },
            { id: 14, color: 'red', target: "ã‚¬ã‚¹ãƒˆ", riddle: "çœ‹æ¿ã®é³¥ã«åå‰ã¯ã‚ã‚‹ï¼Ÿ", answer: "ãªã„", trueAnswer: "ã‚¬ã‚¹ãƒˆ", identified: false, solved: false, riddleCleared: false, clearsId: 11 },
            { id: 15, color: 'blue', target: "ã‚³ã‚«ã‚³ãƒ¼ãƒ©", riddle: "ã‚µãƒ³ã‚¿ã‚’èµ¤ãã—ãŸä¼šç¤¾ã¯ï¼Ÿ", answer: "ã‚³ã‚«ã‚³ãƒ¼ãƒ©", trueAnswer: "ã‚³ãƒ¼ã‚¯", identified: false, solved: false, riddleCleared: false, clearsId: 9 }
        ];

        let MASTER = []; let route = 'none'; let items = 10; let lines = []; let current = null; let itemMode = false; let finaleSeen = false;

        function load() {
            const saved = localStorage.getItem('bingo_grand_v7_save');
            if(saved) {
                const d = JSON.parse(saved); MASTER = d.m; route = d.r; items = d.i; lines = d.l; finaleSeen = d.f || false;
            } else { MASTER = JSON.parse(JSON.stringify(DEFAULT_DATA)); }
            render(); updateUI();
            if(MASTER.every(c => c.solved) && !finaleSeen) showFinale();
        }

        function save() { 
            localStorage.setItem('bingo_grand_v7_save', JSON.stringify({ m: MASTER, r: route, i: items, l: lines, f: finaleSeen })); 
            if(MASTER.every(c => c.solved) && !finaleSeen) showFinale();
        }

        function render() {
            const board = document.getElementById("bingo-board"); board.innerHTML = "";
            MASTER.forEach((d, i) => {
                const cell = document.createElement("div"); cell.className = `cell col-${d.color}`;
                if(d.identified) cell.classList.add("identified");
                if(d.solved) cell.classList.add("complete");
                let ans = (route === 'cross') ? d.trueAnswer : d.answer;
                cell.innerHTML = `<span>${d.target}</span>` + (d.riddleCleared ? `<div class="ans-label">ç­”: ${ans}</div>` : "");
                cell.onclick = () => itemMode ? useItem(i) : openModal(i);
                board.appendChild(cell);
            });
        }

        function updateUI() {
            document.getElementById("item-count").innerText = items;
            const b = document.getElementById("use-item-btn"); b.disabled = items <= 0;
            b.innerText = itemMode ? "CANCEL" : "ITEM USE"; b.style.background = itemMode ? "#ef4444" : "";
        }

        function toggleItemMode() { itemMode = !itemMode; updateUI(); }

        function useItem(i) {
            if(MASTER[i].identified || MASTER[i].solved) return;
            items--; MASTER[i].identified = true; itemMode = false; save(); updateUI(); render(); openModal(i);
        }

        async function openModal(i) {
            current = i; const d = MASTER[i];
            document.getElementById("modal-title").innerText = d.target; document.getElementById("modal").style.display = "block";
            document.getElementById("target-selection-area").style.display = "none"; document.getElementById("check-ans-btn").disabled = false;
            if(d.identified) {
                document.getElementById("capture-section").style.display = "none"; document.getElementById("riddle-section").style.display = "block";
                document.getElementById("riddle-text").innerText = d.riddle;
            } else {
                document.getElementById("capture-section").style.display = "block"; document.getElementById("riddle-section").style.display = "none";
                document.getElementById("video").style.display = "block"; document.getElementById("canvas").style.display = "none";
                try { const s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }); document.getElementById("video").srcObject = s; } catch(e) { alert("Camera Error"); }
            }
        }

        async function analyzeSpot() {
            const k = document.getElementById("test-api-key").value; if(!k) return alert("API Key Required");
            const v = document.getElementById("video"); const c = document.getElementById("canvas");
            c.width = v.videoWidth; c.height = v.videoHeight; c.getContext("2d").drawImage(v, 0, 0);
            v.style.display = "none"; c.style.display = "block";
            const img = c.toDataURL("image/jpeg", 0.7).split(",")[1];
            try {
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${k}`, {
                    method: 'POST', body: JSON.stringify({ contents: [{ parts: [{ text: `Is "${MASTER[current].target}" here? YES/NO.` }, { inline_data: { mime_type: "image/jpeg", data: img } }] }] })
                });
                const res = await r.json();
                if(res.candidates[0].content.parts[0].text.toUpperCase().includes("YES")) {
                    MASTER[current].identified = true; save();
                    document.getElementById("capture-section").style.display = "none"; document.getElementById("riddle-section").style.display = "block";
                    document.getElementById("riddle-text").innerText = MASTER[current].riddle;
                } else { v.style.display = "block"; c.style.display = "none"; alert("åˆ¤å®šå¤±æ•—"); }
            } catch(e) { alert("AI Error"); }
        }

        function verifyAnswer() {
            const input = document.getElementById("answer-input").value.trim();
            const d = MASTER[current];
            const okN = (input === d.answer); const okT = (input === d.trueAnswer);
            if(route === 'self' && !okN) return alert("ä¸æ­£è§£");
            if(route === 'cross' && !okT) return alert("ä¸æ­£è§£");
            if(route === 'none' && !okN && !okT) return alert("ä¸æ­£è§£");

            document.getElementById("check-ans-btn").disabled = true;
            document.getElementById("target-selection-area").style.display = "block";
            const list = document.getElementById("target-list"); list.innerHTML = "";
            MASTER.forEach((m, idx) => {
                if(!m.solved) {
                    const isS = (idx === current); const isC = (idx === d.clearsId);
                    if(route === 'none' || (route === 'self' && isS) || (route === 'cross' && isC)) {
                        if((route === 'none' && ((isS && okN) || (isC && okT))) || (route !== 'none')) {
                            const b = document.createElement("button"); b.className = "btn-target";
                            b.innerText = `ãƒã‚¹${idx+1}: ${m.target}` + (isS ? " (Self)" : "");
                            b.onclick = () => finalize(idx); list.appendChild(b);
                        }
                    }
                }
            });
        }

        function finalize(targetIdx) {
            if(route === 'none') route = (targetIdx === current) ? 'self' : 'cross';
            if(!MASTER[targetIdx].identified) return alert("å¯¾è±¡ãŒæœªé–‹æ”¾ã§ã™");
            MASTER[current].riddleCleared = true; MASTER[targetIdx].solved = true;
            save(); checkBingo(); closeModal(); render();
        }

        function checkBingo() {
            const p = [[0,1,2,3],[4,5,6,7],[8,9,10,11],[12,13,14,15],[0,4,8,12],[1,5,9,13],[2,6,10,14],[3,7,11,15],[0,5,10,15],[3,6,9,12]];
            let hit = false;
            p.forEach((line, i) => { if(line.every(idx => MASTER[idx].solved) && !lines.includes(i)) { lines.push(i); items++; hit = true; } });
            if(hit) { document.getElementById("bingo-overlay").style.display = "flex"; setTimeout(()=>document.getElementById("bingo-overlay").style.display="none", 2500); updateUI(); }
        }

        function showFinale() {
            const overlay = document.getElementById("clear-overlay");
            const title = document.getElementById("clear-title");
            const msg = document.getElementById("clear-msg");
            const hint = document.getElementById("hint-box");
            const btn = document.getElementById("close-finale-btn");
            overlay.style.display = "flex";
            if(route === 'self') {
                title.innerText = "NORMAL END";
                msg.innerText = "ã™ã¹ã¦ã‚’è‡ªåˆ†è‡ªèº«ã§åŸ‹ã‚ã¾ã—ãŸã€‚\nå†™çœŸãƒ‡ãƒ¼ã‚¿ã¯æ®‹ã—ã¦ãŠãã¾ã—ãŸã€‚";
                hint.style.display = "block";
                hint.innerText = "ã€æ–°ã‚¨ãƒ³ãƒ‰ã¸ã®é“ã€‘\nå…¨ãƒã‚¹ã®ã‚¹ã‚­ãƒ£ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’é–‹æ”¾çŠ¶æ…‹ã§ç¶­æŒã—ã¾ã—ãŸã€‚\næœ€åˆã®ä¸€æ‰‹ã§ã€Œåˆ¥ã®æ­£è§£ã€ã‚’æ‰“ã¡è¾¼ã¿ã€ãƒ‘ã‚ºãƒ«ã®é€£é–ã‚’è§£ãæ˜ã‹ã—ã¦ãã ã•ã„ã€‚";
                btn.innerText = "æ–°ã‚¨ãƒ³ãƒ‰ã®æ¤œè¨ã‚’å§‹ã‚ã‚‹";
            } else {
                title.innerHTML = "TRUE ENDING";
                msg.innerText = "é€£é–ã®è¬ã‚’è§£ãæ˜ã‹ã—ã€çœŸå®Ÿã®ç­”ãˆã«è¾¿ã‚Šç€ãã¾ã—ãŸï¼";
                btn.innerText = "ãƒœãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹";
                createConfetti();
            }
        }

        function closeFinale() {
            // â˜…ãƒãƒ¼ãƒãƒ«ã‚¨ãƒ³ãƒ‰æ™‚ã®ã¿ã€ã€Œå…¨é–‹æ”¾ï¼†æœªã‚¯ãƒªã‚¢ã€çŠ¶æ…‹ã¸ç§»è¡Œ
            if(route === 'self') {
                MASTER.forEach(d => { d.identified = true; d.solved = false; d.riddleCleared = false; });
                route = 'none'; // ãƒ«ãƒ¼ãƒˆé¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
                items = 0; lines = []; // ã‚¢ã‚¤ãƒ†ãƒ ã‚„ãƒ“ãƒ³ã‚´é€²æ—ã‚‚ã‚¯ãƒªã‚¢
                finaleSeen = false; // å†ã³ã‚¯ãƒªã‚¢ã™ã‚Œã°ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒå‡ºã‚‹ã‚ˆã†ã«
                alert("æ¤œè¨ãƒ¢ãƒ¼ãƒ‰ï¼šå…¨ãƒã‚¹ã®ã‚¹ã‚­ãƒ£ãƒ³ãŒå®Œäº†ã—ãŸçŠ¶æ…‹ã§ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã—ãŸã€‚");
            } else {
                finaleSeen = true; // çœŸã‚¨ãƒ³ãƒ‰ãªã‚‰å®Œé‚çŠ¶æ…‹ã‚’ç¶­æŒ
            }
            save();
            document.getElementById("clear-overlay").style.display = "none";
            render();
        }

        function createConfetti() {
            const container = document.getElementById("confetti-container"); container.innerHTML = "";
            for(let i=0; i<60; i++) {
                const c = document.createElement("div"); c.className = "confetti";
                c.style.left = Math.random() * 100 + "vw"; c.style.animationDelay = Math.random() * 3 + "s";
                c.style.backgroundColor = ["#ffd700", "#ffffff", "#ffcc00"][Math.floor(Math.random()*3)];
                container.appendChild(c);
            }
        }

        function closeModal() {
            const v = document.getElementById("video"); if(v.srcObject) v.srcObject.getTracks().forEach(t=>t.stop());
            document.getElementById("modal").style.display = "none"; render();
        }

        function resetGame() { if(confirm("å®Œå…¨ã«æ¶ˆå»ã—ã¦æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ")) { localStorage.clear(); location.reload(); } }

        load();
    </script>
</body>
</html>
